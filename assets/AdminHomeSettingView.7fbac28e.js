import{C as g,u as q,r as w,o as V,c as R,a as r,b as s,w as o,ad as p,aq as _,S as i,bs as U,N as m,bt as H,L as y,aE as $,bu as j,bv as D,bw as I,A as f}from"./index.ec167b05.js";import{_ as L}from"./DataTable.2b33b5bd.js";import{_ as W}from"./Upload.7a5c94ca.js";import{N as G}from"./Image.6a3be9b4.js";import"./Checkbox.437378c3.js";import"./Select.b84241ef.js";const J={id:"HomeSetting"},K=r("h1",null,"\u9996\u9801\u7BA1\u7406",-1),O=r("h2",null,"Banner",-1),Q={class:"editorButton"},X=y(" \u65B0\u589E "),Y={class:"bannerFormContent"},Z=y("\u4E0A\u50B3\u5716\u7247"),ee={style:{display:"flex","justify-content":"flex-end"},class:"submitButton"},te={href:"#admin/"},ne=r("button",{type:"submit",class:"saveBtn"},"\u4FDD\u5B58",-1),ue={__name:"AdminHomeSettingView",setup(se){const x=g("medium"),C=g(null),k={width:"600px"},B=q(),E=()=>[{title:"\u6A19\u984C",key:"bannerTitle"},{title:"\u5716\u7247",key:"image",render(n){return f(G,{strong:!0,tertiary:!0,width:100,src:n.bannerPic},{default:()=>"\u522A\u9664"})}},{title:"\u7DE8\u8F2F",key:"editor",render(n){return f(m,{strong:!0,tertiary:!0,size:"small",onClick:()=>h(n._id,n.idx)},{default:()=>"\u7DE8\u8F2F"})}},{title:"\u522A\u9664",key:"del",render(n){return f(m,{strong:!0,tertiary:!0,size:"small",onClick:()=>v(n._id)},{default:()=>"\u522A\u9664"})}}],t=w({_id:"",bannerTitle:"",bannerPic:[],idx:-1,showModal:!1,show:!1}),a=w([]),P={bannerTitle:{required:!0,trigger:["blur","input"],validator(n,e){if(e){if(e.length<=1)return new Error("\u5B57\u6578\u4E0D\u80FD\u5C11\u65BC2");if(e.length>=10)return new Error("\u5B57\u6578\u4E0D\u80FD\u591A\u65BC10")}else return new Error("\u9700\u8981\u6A19\u984C");return!0}},bannerPic:{required:!0,validator(n,e){var l,d,u;if(e){if(!e.length||((d=(l=e[0])==null?void 0:l.type)==null?void 0:d.includes("image"))&&((u=e[0])==null?void 0:u.size)<1024*1024)return new Error("\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26")}else return new Error("\u9700\u8981\u5716\u7247");return!0}}},h=(n,e)=>{t._id=n,e>-1?(t.bannerTitle=a[e].bannerTitle,t.bannerPic=a[e].bannerPic):t.bannerTitle="",t.showModal=!0,t.bannerPic=[],t.idx},T=async()=>{t.show=!0;const n=new FormData;for(const e in t)["_id","idx","show"].includes(e)||(e==="bannerPic"?t.bannerPic.length>0&&n.append(e,t[e][0].file):n.append(e,t[e]));try{if(t._id.length===0)await _.post("/banners",n),i.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),B.push("/admin/admin-home-setting");else{const{data:e}=await _.patch("/banners/"+t._id,n);a[t.idx]=e.result,i.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.showModal=!1}catch(e){i.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message}),t.showModal=!1}t.show=!1},v=n=>{i.fire({title:"\u78BA\u5B9A\u522A\u9664\u55CE?",text:"\u522A\u9664\u5F8C\u7121\u6CD5\u56DE\u5FA9!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"\u5C0D\uFF0C\u522A\u9664!"}).then(async e=>{await _.delete("/banners/"+n),e.isConfirmed&&i.fire("\u522A\u9664\u6210\u529F","success"),b()}).catch(e=>{i.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})})},b=async()=>{try{let n=0;const{data:e}=await _.get("./banners/all");a.push(...e.result),a.forEach(l=>{l.idx=n++})}catch(n){i.fire({icon:"error",title:"\u5931\u6557",text:n.isAxiosError?n.response.data.message:n.message})}};b();const M={pageSize:8},z=E();return(n,e)=>{const l=L,d=$,u=j,S=W,N=D,A=I,F=U;return V(),R("section",J,[K,O,r("div",Q,[s(p(m),{type:"primary",color:"#64C1C6",onClick:e[0]||(e[0]=c=>h("",-1))},{default:o(()=>[X]),_:1})]),r("div",Y,[r("div",null,[s(l,{columns:p(z),data:a,pagination:M,bordered:!1},null,8,["columns","data"])]),s(F,{show:t.showModal,"onUpdate:show":e[3]||(e[3]=c=>t.showModal=c),class:"editCard",preset:"card",style:k,title:"\u7DE8\u8F2F\u8868\u55AE",size:"huge",bordered:!1},{default:o(()=>[s(A,{class:"bannerForm",ref_key:"formRef",ref:C,model:t,rules:P,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",size:x.value,style:{maxWidth:"1000px"},onSubmit:H(T,["prevent"])},{default:o(()=>[s(u,{label:"\u5716\u7247\u6A19\u984C",path:"bannerTitle"},{default:o(()=>[s(d,{value:t.bannerTitle,"onUpdate:value":e[1]||(e[1]=c=>t.bannerTitle=c),placeholder:"\u8ACB\u8F38\u5165\u5716\u7247\u6A19\u984C"},null,8,["value"])]),_:1}),s(u,{label:"\u5716\u7247",path:"bannerPic"},{default:o(()=>[s(S,{"file-list":t.bannerPic,"onUpdate:file-list":e[2]||(e[2]=c=>t.bannerPic=c),accept:"image/*"},{default:o(()=>[s(p(m),null,{default:o(()=>[Z]),_:1})]),_:1},8,["file-list"])]),_:1}),r("div",ee,[r("a",te,[s(N,{show:t.show},{default:o(()=>[ne]),_:1},8,["show"])])])]),_:1},8,["model","size","onSubmit"])]),_:1},8,["show"])])])}}};export{ue as default};
